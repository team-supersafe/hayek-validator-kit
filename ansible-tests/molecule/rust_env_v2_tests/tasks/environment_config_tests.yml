---
- name: Verify cargo_home/env file content
  ansible.builtin.slurp:
    src: "{{ cargo_home }}/env"
  register: cargo_env_content

- name: Assert cargo_home/env contains CARGO_HOME
  ansible.builtin.assert:
    that:
      - "'CARGO_HOME' in cargo_env_content.content | b64decode"
    fail_msg: "cargo_home/env file does not contain CARGO_HOME variable"
    success_msg: "✅ cargo_home/env file contains CARGO_HOME variable"

- name: Assert cargo_home/env contains RUSTUP_HOME
  ansible.builtin.assert:
    that:
      - "'RUSTUP_HOME' in cargo_env_content.content | b64decode"
    fail_msg: "cargo_home/env file does not contain RUSTUP_HOME variable"
    success_msg: "✅ cargo_home/env file contains RUSTUP_HOME variable"

- name: Verify global profile script content
  ansible.builtin.slurp:
    src: /etc/profile.d/rust.sh
  register: rust_profile_content

- name: Assert global profile script contains CARGO_HOME export
  ansible.builtin.assert:
    that:
      - "'export CARGO_HOME' in rust_profile_content.content | b64decode"
      - "'{{ cargo_home }}' in rust_profile_content.content | b64decode"
    fail_msg: "Global profile script does not export CARGO_HOME correctly"
    success_msg: "✅ Global profile script exports CARGO_HOME correctly"

- name: Assert global profile script contains RUSTUP_HOME export
  ansible.builtin.assert:
    that:
      - "'export RUSTUP_HOME' in rust_profile_content.content | b64decode"
      - "'{{ rustup_home }}' in rust_profile_content.content | b64decode"
    fail_msg: "Global profile script does not export RUSTUP_HOME correctly"
    success_msg: "✅ Global profile script exports RUSTUP_HOME correctly"

- name: Assert global profile script adds cargo bin to PATH
  ansible.builtin.assert:
    that:
      - "'export PATH' in rust_profile_content.content | b64decode"
      - "'{{ cargo_home }}/bin' in rust_profile_content.content | b64decode"
    fail_msg: "Global profile script does not add cargo bin to PATH"
    success_msg: "✅ Global profile script adds cargo bin to PATH"

