---
# Agave Validator Setup
# -------------------
# Installs and configures an agave validator on a target host.
#
# Usage:
# ------
# Run from /ansible directory:
#
# ansible-playbook playbooks/pb_setup_validator_agave.yml \
#   -i solana_localnet.yml \
#   --limit host-charlie \
#   -e "target_host=host-charlie" \
#   -e "validator_name=my-validator" \
#   -e "validator_type=primary"
#
# For syntax check add --syntax-check
# For dry run add --diff --check

- name: Setup Agave Validator
  hosts: "{{ target_host }}"
  user: "{{ solana_user }}"
  become: false

  pre_tasks:
    - name: Assert required parameters are defined
      ansible.builtin.assert:
        that:
          - target_host is defined
          - validator_name is defined
          - validator_type is defined
        fail_msg: >
          Missing required variables.
          Must provide:
            - target_host
            - validator_name
            - validator_type

    - name: Validate validator_type value
      ansible.builtin.assert:
        that:
          - validator_type in ['primary', 'hot-spare']
        fail_msg: "Invalid validator_type '{{ validator_type }}'. Must be 'primary' or 'hot-spare'."

  roles:
    - role: solana_cli
    - role: solana_validator_agave
