---
- name: Check if SSH key files exist
  ansible.builtin.stat:
    path: "{{ inventory_dir }}/iam/users/{{ item }}.pub"
  register: ssh_key_check
  loop:
    - daryl
    - sol
    - eydel
    - yamel
    - michel
    - alex
  delegate_to: localhost
  run_once: true

- name: Fail if SSH key files are missing
  ansible.builtin.fail:
    msg: "SSH key file for {{ item.item }} is missing. Please ensure all required SSH key files exist in the ssh_keys directory."
  when: not item.stat.exists
  loop: "{{ ssh_key_check.results }}"
  delegate_to: localhost
  run_once: true

- name: Display message in console
  ansible.builtin.debug:
    msg: "{{ inventory_dir }}"
  delegate_to: localhost
  run_once: true
