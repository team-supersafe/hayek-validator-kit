# Validator Operators - Service management and monitoring
# This file is managed by Ansible - DO NOT EDIT MANUALLY

# Allow group members to become validator_operators without password
# This is required for Ansible to use become_user: validator_operators

# Allow validator_operators group to start a login shell as sol without password
# For this sol user must be created with `shell: /usr/sbin/bash` instead of `shell: /usr/sbin/nologin`
%validator_operators ALL=(sol) NOPASSWD: ALL

# Service control commands
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl start {{ validator_service }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop {{ validator_service }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart {{ validator_service }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop cron
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl start cron

# Process management
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/pkill -f {{ validator_service }}
%validator_operators ALL=(sol) NOPASSWD: /usr/bin/taskset

# System monitoring
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/htop

# Service control commands (enable/disable only - status inherited from viewers)
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl enable {{ validator_service }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/systemctl disable {{ validator_service }}

# Package management commands
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install apt-utils
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install locales
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install python3-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install python3-setuptools
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install python3-yaml
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install software-properties-common
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install rsyslog
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install sudo
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install iproute2
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install openssh-client
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install openssh-server
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install nano
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install openssl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install tar
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install less
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install tree
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install at
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install htop
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install apt-utils
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install locales
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install python3-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install python3-setuptools
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install python3-yaml
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install software-properties-common
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install rsyslog
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install sudo
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install iproute2
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install openssh-client
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install openssh-server
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install nano
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install openssl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install tar
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install less
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install tree
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install at
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install htop
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove apt-utils
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove locales
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove python3-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove python3-setuptools
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove python3-yaml
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove software-properties-common
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove rsyslog
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove sudo
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove iproute2
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove openssh-client
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove openssh-server
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove nano
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove openssl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove tar
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove less
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove tree
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove at
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove htop
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove apt-utils
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove locales
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove python3-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove python3-setuptools
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove python3-yaml
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove software-properties-common
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove rsyslog
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove sudo
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove iproute2
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove openssh-client
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove openssh-server
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove nano
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove openssl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove tar
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove less
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove tree
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove at
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove htop
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get update
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt update
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get upgrade
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt upgrade
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install git
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install curl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install wget
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install build-essential
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install pkg-config
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install libssl-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install libudev-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install libclang-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install clang
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install cmake
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install python3
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install python3-pip
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install jq
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get install logrotate
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install git
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install curl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install wget
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install build-essential
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install pkg-config
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install libssl-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install libudev-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install libclang-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install clang
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install cmake
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install python3
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install python3-pip
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install jq
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt install logrotate
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove git
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove curl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove wget
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove build-essential
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove pkg-config
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove libssl-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove libudev-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove libclang-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove clang
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove cmake
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove python3
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove python3-pip
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove jq
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt-get remove logrotate
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove git
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove curl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove wget
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove build-essential
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove pkg-config
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove libssl-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove libudev-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove libclang-dev
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove clang
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove cmake
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove python3
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove python3-pip
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove jq
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/apt remove logrotate
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/dpkg --configure -a


# Development tools and utilities
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/curl
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/wget
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/git
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cargo
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rustup
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rustc

# Log management (basic log viewing inherited from viewers)

# Allow copying validator config directories to any backup location
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cp -r {{ system_solana_install_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cp -r {{ system_shared_build_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cp -r {{ jito_relayer_install_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cp -r {{ validator_logs_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cp -r {{ validator_keys_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/cp -r {{ validator_scripts_dir }} *

# Allow moving validator config directories to any location (also allows rename)
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mv {{ system_solana_install_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mv {{ system_shared_build_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mv {{ jito_relayer_install_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mv {{ validator_logs_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mv {{ validator_keys_dir }} *
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mv {{ validator_scripts_dir }} *

# Allow deleting files inside validator directories (but not the directories themselves)
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm -r {{ system_solana_install_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm -r {{ system_shared_build_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm -r {{ jito_relayer_install_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm -r {{ validator_logs_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm -r {{ validator_keys_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm -r {{ validator_scripts_dir }}/*

# Allow removing the symbolic link to the current validator identity.
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm identity.json
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/rm {{ validator_keys_dir }}/*/identity.json

# Allow building a symbolic link in the current directory
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/ln -s primary-target-identity.json identity.json
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/ln -s hot-spare-identity.json identity.json

# Allow building a symbolic link using validator paths
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/ln -s {{ validator_keys_dir }}/*/primary-target-identity.json {{ validator_keys_dir }}/*/identity.json
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/ln -s {{ validator_keys_dir }}/*/hot-spare-identity.json {{ validator_keys_dir }}/*/identity.json

%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/chown {{ validator_logs_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/chmod {{ validator_keys_dir }}/*
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/chmod {{ validator_scripts_dir }}/*

# Directory management
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mkdir -p {{ validator_ledger_dir }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mkdir -p {{ validator_accounts_dir }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/mkdir -p {{ validator_snapshots_dir }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/chown -R {{ validator_ledger_dir }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/chown -R {{ validator_accounts_dir }}
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/chown -R {{ validator_snapshots_dir }}

# Key management
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/solana-keygen
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/agave-validator

# Monitoring and debugging
%validator_operators ALL=(ALL) NOPASSWD: /usr/bin/strace -p

# Shell access (requires password)
%validator_operators ALL=(ALL) PASSWD: /bin/sh

# ========================================
# INHERITED PERMISSIONS FROM VALIDATOR_VIEWERS
# ========================================
{% set viewers_content = lookup('template', '40-validator-viewers.j2') %}
{{ viewers_content | regex_replace('%validator_viewers', '%validator_operators') }}
