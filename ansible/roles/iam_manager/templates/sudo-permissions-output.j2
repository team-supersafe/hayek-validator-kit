# REAL USER PERMISSIONS FOR {{ item.item.key }}
# ================================================
# This file shows the REAL permissions you have on this server
# based on your current sudoers configuration
#
# Automatically generated by Ansible
# Last updated: {{ ansible_date_time.iso8601 }}

{% if item.stdout is defined and item.stdout != "" %}
{% set lines = item.stdout.split('\n') %}
{% for line in lines %}
{% if line.strip() and not line.startswith('Matching Defaults') and not line.startswith('User') and not line.startswith('    env_reset') and not line.startswith('    secure_path') and not line.startswith('    passwd_timeout') %}
{% if '(ALL) NOPASSWD:' in line %}
{% set command = line.split('(ALL) NOPASSWD:')[1].strip() %}
{% if command.startswith('/usr/bin/') %}
{{ command[9:] }}
{% else %}
{{ command }}
{% endif %}
{% elif '(ALL) PASSWD:' in line %}
{% set command = line.split('(ALL) PASSWD:')[1].strip() %}
{% if command.startswith('/usr/bin/') %}
{{ command[9:] }}
{% else %}
{{ command }}
{% endif %}
{% endif %}
{% endif %}
{% endfor %}
{% else %}
# Could not retrieve permissions for this user
# Possible reasons:
# - User does not exist
# - User has no sudo permissions configured
# - Error retrieving permissions
{% endif %}

# ================================================
# ADDITIONAL INFORMATION
# ================================================

# To check your current permissions, run:
#   sudo -l -U {{ item.item.key }}

# To change your password:
#   sudo reset-my-password

# To view this file:
#   cat /home/{{ item.item.key }}/permissions.txt

# ================================================
# USER GROUPS
# ================================================
{% if item.item.value.group_a is defined and item.item.value.group_a != "" %}
- {{ item.item.value.group_a }}
{% endif %}
{% if item.item.value.group_b is defined and item.item.value.group_b != "" %}
- {{ item.item.value.group_b }}
{% endif %}
{% if item.item.value.group_c is defined and item.item.value.group_c != "" %}
- {{ item.item.value.group_c }}
{% endif %}
{% if item.item.value.group_d is defined and item.item.value.group_d != "" %}
- {{ item.item.value.group_d }}
{% endif %}

# ================================================
# SUPPORT CONTACT
# ================================================
# If you have issues with your permissions, contact the infrastructure team
# or run: sudo reset-my-password to change your password
