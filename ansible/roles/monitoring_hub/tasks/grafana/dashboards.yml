---
# Grafana dashboard management tasks

- name: Create custom dashboards directory
  ansible.builtin.file:
    path: "{{ grafana_config.dashboards_dir }}/custom"
    state: directory
    owner: "{{ grafana_config.permissions.data_dirs.owner }}"
    group: "{{ grafana_config.permissions.data_dirs.group }}"
    mode: "{{ grafana_config.permissions.data_dirs.mode }}"

- name: Copy Solana validator dashboards
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "{{ grafana_config.dashboards_dir }}/custom/"
    owner: "{{ grafana_config.permissions.config_files.owner }}"
    group: "{{ grafana_config.permissions.config_files.group }}"
    mode: "{{ grafana_config.permissions.config_files.mode }}"
  loop: "{{ grafana_custom_dashboards }}"
  notify: restart grafana
  when: grafana_custom_dashboards is defined

- name: Install Grafana plugins
  ansible.builtin.command:
    cmd: "grafana-cli plugins install {{ item }}"
  loop: "{{ grafana_plugins }}"
  notify: restart grafana
  when: grafana_plugins is defined
  become: yes

