---
- name: verify - Check if agave-validator binary exists
  ansible.builtin.stat:
    path: "{{ solana_install_dir }}/agave-validator"
  register: agave_validator_binary

- name: verify - Fail if agave-validator binary is missing
  ansible.builtin.fail:
    msg: "Agave-validator binary not found at {{ solana_install_dir }}/agave-validator!"
  when: not agave_validator_binary.stat.exists

- name: verify - Check agave validator systemd service status
  ansible.builtin.systemd:
    name: "{{ validator_service_name | default('agave-validator') }}"
  register: agave_validator_service

- name: verify - Get last 50 lines of agave validator logs
  ansible.builtin.shell: journalctl -u {{ validator_service_name | default('agave-validator') }} --no-pager | tail -n 50
  register: agave_validator_logs
  changed_when: false

- name: verify - Print last 50 lines of agave validator logs
  ansible.builtin.debug:
    var: agave_validator_logs.stdout_lines

- name: verify - Print agave validator monitoring hints
  ansible.builtin.debug:
    msg: ðŸš€ Agave Validator Setup Complete! 