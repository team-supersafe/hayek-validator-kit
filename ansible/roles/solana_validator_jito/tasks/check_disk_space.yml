---
- name: Get final disk space
  ansible.builtin.shell: |
    df -h /home/sol | awk 'NR==2 {print $4}'
  register: final_space
  changed_when: false
  when: jito_relayer_verify | default(true)

- name: Calculate space used
  ansible.builtin.set_fact:
    space_used: "{{ initial_space.stdout | regex_replace('^([0-9]+)([KMG])$', '\\1') | int - final_space.stdout | regex_replace('^([0-9]+)([KMG])$', '\\1') | int }}"
  when: jito_relayer_verify | default(true)

- name: Print space usage summary
  ansible.builtin.debug:
    msg: |
      Disk space usage summary:
      - Initial available space: {{ initial_space.stdout }}
      - Final available space: {{ final_space.stdout }}
      - Space used: {{ space_used }}G
      - Minimum required space (experimental): {{ min_required_space }}
  when: jito_relayer_verify | default(true) 