---
# Get user information and display groups
- name: Get user groups
  ansible.builtin.shell:
    cmd: "groups {{ ansible_user }}"
    executable: /bin/bash
  register: user_groups_result
  ignore_errors: true

- name: Display user groups
  ansible.builtin.debug:
    msg: "User {{ ansible_user }} belongs to groups: {{ user_groups_result.stdout | default('No groups found') }}"

- name: Set fact if user is in sysadmin group
  ansible.builtin.set_fact:
    is_sysadmin: "{{ 'sysadmin' in (user_groups_result.stdout | default('')) }}"
  when: user_groups_result is defined
  tags: always

- name: Pause before testing permissions
  ansible.builtin.pause:
    seconds: 2
    prompt: "Testing RBAC permissions for {{ ansible_user }}..."
